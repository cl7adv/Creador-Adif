<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Log Station v4.3.5 - Alfred CL7ADV</title>
    <style>
        :root {
            --bg-dark: #0a192f;
            --panel-bg: #112240;
            --neon-cyan: #00e5ff;
            --neon-pink: #ff007f;
            --neon-yellow: #ffea00;
            --text-main: #e6f1ff;
            --sunrise-gradient: linear-gradient(0deg, #ff7e5f 0%, #feb47b 50%, #0a192f 100%);
        }

        body, html {
            height: 100%;
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
        }

        /* PANTALLA DE BIENVENIDA (Sunrise Effect) */
        #splash-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: var(--bg-dark);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.8s ease-out;
            overflow: hidden;
        }

        /* El sol del amanecer */
        .sun {
            position: absolute;
            bottom: -100px;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, #ffea00, #ff7e5f);
            border-radius: 50%;
            box-shadow: 0 0 60px #ff7e5f;
            animation: sunrise-anim 2.5s forwards ease-out;
            z-index: 1;
        }

        @keyframes sunrise-anim {
            0% { bottom: -150px; opacity: 0; }
            100% { bottom: 20%; opacity: 1; }
        }

        .splash-content {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .splash-title {
            font-size: 3rem;
            color: var(--neon-cyan);
            font-style: italic;
            font-weight: 900;
            text-shadow: 0 0 20px var(--neon-cyan);
            margin-bottom: 10px;
        }

        .splash-welcome {
            font-size: 1.2rem;
            color: var(--text-main);
            letter-spacing: 2px;
            margin-bottom: 30px;
        }

        .loader {
            width: 200px; height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            position: relative;
            overflow: hidden;
            margin: 0 auto;
        }

        .loader::after {
            content: '';
            position: absolute;
            width: 0%; height: 100%;
            background: var(--neon-pink);
            animation: load 2.5s forwards;
            box-shadow: 0 0 10px var(--neon-pink);
        }

        @keyframes load { 0% { width: 0%; } 100% { width: 100%; } }

        #main-content {
            display: none;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .station-title {
            font-style: italic;
            font-weight: 900;
            font-size: 2.5rem;
            color: var(--neon-cyan);
            text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
        }

        .utc-container {
            text-align: right;
            background: rgba(0, 229, 255, 0.05);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(0, 229, 255, 0.2);
        }

        .utc-clock {
            font-size: 2.2rem;
            color: var(--neon-yellow);
            font-weight: bold;
            font-family: monospace;
        }

        /* DASHBOARD LAYOUT */
        .dashboard {
            display: grid;
            grid-template-columns: 350px 1fr 250px;
            gap: 20px;
        }

        .panel {
            background: var(--panel-bg);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0, 229, 255, 0.1);
        }

        .reg-qso { border-left: 5px solid var(--neon-pink); }
        .op-panel { border-top: 5px solid var(--neon-cyan); }
        
        .input-field {
            background: #0d1b2a;
            border: 1px solid #1e3a5f;
            color: white;
            padding: 10px;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .btn-group { display: flex; gap: 5px; margin-bottom: 15px; flex-wrap: wrap; }
        
        .btn-action {
            padding: 8px 12px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.75rem;
            text-transform: uppercase;
            transition: all 0.2s;
        }

        .btn-action:hover { filter: brightness(1.2); transform: translateY(-1px); }
        .btn-qrz { background: #ff9800; color: white; }
        .btn-adif { background: var(--neon-cyan); color: #0a192f; }
        .btn-csv { background: #4caf50; color: white; }
        .btn-del { background: #f44336; color: white; }
        .btn-edit { background: #2196F3; color: white; margin-right: 5px; }

        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        th { color: var(--neon-yellow); text-align: left; padding: 10px; border-bottom: 2px solid #1e3a5f; }
        td { padding: 12px 10px; border-bottom: 1px solid #1e3a5f; }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 0.8rem;
            color: var(--neon-yellow);
        }

        .signature {
            margin-top: 20px;
            font-size: 0.8rem;
            color: var(--neon-cyan);
            text-align: center;
            font-style: italic;
            border-top: 1px solid #1e3a5f;
            padding-top: 15px;
        }

        .editing-mode {
            border: 2px solid var(--neon-yellow) !important;
            box-shadow: 0 0 15px var(--neon-yellow);
        }
    </style>
</head>
<body>

    <div id="splash-screen">
        <div class="sun"></div>
        <div class="splash-content">
            <div class="splash-title">NEON LOG STATION</div>
            <div class="splash-welcome">BIENVENIDOS COLEGAS RADIOPERADORES</div>
            <div class="loader"></div>
            <div style="margin-top: 20px; font-size: 0.8rem; color: #e6f1ff; text-shadow: 0 0 5px #000;">By Alfred CL7ADV</div>
        </div>
    </div>

    <div id="main-content">
        <div class="top-bar">
            <div>
                <div class="station-title">NEON LOG STATION <span style="font-size: 1rem;">v4.3.5</span></div>
                <div style="color: var(--neon-cyan); font-size: 0.8rem; letter-spacing: 3px;">CAMAGÃœEY - SANTA CRUZ DEL SUR</div>
            </div>
            <div class="utc-container">
                <span class="utc-date" id="date-utc">YYYY-MM-DD</span>
                <div class="utc-clock" id="clock">00:00:00 UTC</div>
            </div>
        </div>

        <div class="dashboard">
            <!-- Registrar QSO -->
            <div class="panel reg-qso" id="formPanel">
                <h3 id="formTitle" style="color: var(--neon-pink)">| REGISTRAR QSO</h3>
                
                <input type="hidden" id="editId">

                <label style="font-size: 0.7rem; color: var(--neon-cyan);">INDICATIVO (CALLSIGN)</label>
                <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                    <input type="text" id="qsoCall" class="input-field" style="font-size: 1.5rem; color: var(--neon-cyan); margin-bottom: 0;" placeholder="CALLSIGN">
                    <button class="btn-action btn-qrz" onclick="checkQRZ('qsoCall')">QRZ</button>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label style="font-size: 0.7rem; color: var(--neon-cyan);">FECHA UTC (YYYY-MM-DD)</label>
                        <input type="text" id="qsoDate" class="input-field" placeholder="2024-01-20">
                    </div>
                    <div style="flex: 1;">
                        <label style="font-size: 0.7rem; color: var(--neon-cyan);">HORA UTC (HH:MM)</label>
                        <input type="text" id="qsoTime" class="input-field" placeholder="14:30">
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label style="font-size: 0.7rem; color: var(--neon-cyan);">NOMBRE</label>
                        <input type="text" id="qsoName" class="input-field" placeholder="Nombre">
                    </div>
                    <div style="flex: 1;">
                        <label style="font-size: 0.7rem; color: var(--neon-cyan);">EMAIL CORRESPONSAL</label>
                        <input type="email" id="qsoEmail" class="input-field" placeholder="email@correo.com">
                    </div>
                </div>

                <div style="display: flex; gap: 10px;">
                    <div style="flex: 1;">
                        <label style="font-size: 0.7rem; color: var(--neon-cyan);">REPORTE (RST)</label>
                        <input type="text" id="qsoRst" class="input-field" value="59">
                    </div>
                    <div style="flex: 1;">
                        <label style="font-size: 0.7rem; color: var(--neon-cyan);">BANDA</label>
                        <select id="qsoBand" class="input-field">
                            <option value="160m">160m</option><option value="80m">80m</option>
                            <option value="60m">60m</option><option value="40m" selected>40m</option>
                            <option value="30m">30m</option><option value="20m">20m</option>
                            <option value="17m">17m</option><option value="15m">15m</option>
                            <option value="12m">12m</option><option value="10m">10m</option>
                            <option value="6m">6m</option><option value="2m">2m</option>
                            <option value="70cm">70cm</option>
                        </select>
                    </div>
                </div>

                <label style="font-size: 0.7rem; color: var(--neon-cyan);">MODO</label>
                <select id="qsoMode" class="input-field">
                    <option value="SSB" selected>SSB</option><option value="CW">CW</option>
                    <option value="FT8">FT8</option><option value="FT4">FT4</option>
                    <option value="FM">FM</option><option value="AM">AM</option>
                    <option value="VARA">VARA</option><option value="Digital Voice">Digital Voice</option>
                    <option value="dmr">dmr</option>
                </select>
                
                <div class="checkbox-container">
                    <input type="checkbox" id="exportQRZ" checked>
                    <label for="exportQRZ">EXPORTAR A QRZ</label>
                </div>

                <label style="font-size: 0.7rem; color: var(--neon-cyan);">COMENTARIO</label>
                <input type="text" id="qsoNotes" class="input-field" placeholder="Gracias 73...">
                
                <div style="display: flex; gap: 5px;">
                    <button id="btnSubmit" class="btn-action btn-adif" style="flex: 3; padding: 15px; margin-top: 10px; font-size: 1rem;" onclick="processQSO()">Grabar Contacto âš¡</button>
                    <button id="btnCancelEdit" class="btn-action btn-del" style="display: none; flex: 1; padding: 15px; margin-top: 10px; font-size: 1rem;" onclick="cancelEdit()">X</button>
                </div>
            </div>

            <!-- Log Book -->
            <div class="panel">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3 style="color: var(--neon-yellow); margin: 0;">LOG BOOK</h3>
                    <input type="text" id="searchLog" placeholder="Buscar..." class="input-field" style="width: 180px; margin-bottom: 0;" oninput="saveAndRender()">
                </div>
                
                <div class="btn-group">
                    <button class="btn-action btn-adif" onclick="downloadADIF()">Exportar ADIF</button>
                    <button class="btn-action btn-csv" onclick="downloadCSV()">CSV</button>
                    <button class="btn-action btn-del" onclick="clearAll()">Borrar Todo</button>
                </div>

                <div style="max-height: 520px; overflow-y: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>CORRESPONSAL</th>
                                <th>FECHA / HORA</th>
                                <th>BANDA / MODO</th>
                                <th>QRZ</th>
                                <th style="text-align: right;">ACC.</th>
                            </tr>
                        </thead>
                        <tbody id="logBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Panel Operador -->
            <div class="panel op-panel">
                <h4 style="color: var(--neon-cyan); margin-top: 0;">OPERADOR</h4>
                <label style="font-size: 0.6rem; color: #888;">MI CALLSIGN</label>
                <input type="text" id="opCall" class="input-field" placeholder="MI CALL" onchange="saveOperator()">
                
                <label style="font-size: 0.6rem; color: #888;">MI NOMBRE</label>
                <input type="text" id="opName" class="input-field" placeholder="Mi Nombre" onchange="saveOperator()">

                <label style="font-size: 0.6rem; color: #888;">MI CORREO (ADIF)</label>
                <input type="email" id="opEmail" class="input-field" placeholder="mi@email.com" onchange="saveOperator()">
                
                <hr style="border: 0; border-top: 1px solid #1e3a5f; margin: 20px 0;">
                
                <div style="text-align: center; background: linear-gradient(to bottom, #ff007f33, transparent); padding: 10px; border-radius: 10px;">
                    <div style="font-size: 2.5rem; font-weight: bold;" id="totalCount">0</div>
                    <div style="color: var(--neon-pink); font-weight: bold; font-size: 0.8rem;">QSOs TOTALES</div>
                </div>

                <div class="signature">Firma: Alfred CL7ADV</div>
            </div>
        </div>
    </div>

    <script>
        // Splash logic
        window.addEventListener('load', () => {
            setTimeout(() => {
                const splash = document.getElementById('splash-screen');
                const main = document.getElementById('main-content');
                splash.style.opacity = '0';
                setTimeout(() => {
                    splash.style.display = 'none';
                    main.style.display = 'block';
                    setTimeout(() => main.style.opacity = '1', 50);
                }, 800);
            }, 3000);
        });

        let qsos = JSON.parse(localStorage.getItem('qsos')) || [];
        let operator = JSON.parse(localStorage.getItem('operator')) || { call: '', name: '', email: '' };
        let isEditing = false;

        function updateClock() {
            if (isEditing) return; // No actualizar campos si estamos editando
            const now = new Date();
            const year = now.getUTCFullYear();
            const month = String(now.getUTCMonth() + 1).padStart(2, '0');
            const day = String(now.getUTCDate()).padStart(2, '0');
            const h = String(now.getUTCHours()).padStart(2, '0');
            const m = String(now.getUTCMinutes()).padStart(2, '0');
            const s = String(now.getUTCSeconds()).padStart(2, '0');

            const dateStr = `${year}-${month}-${day}`;
            const clockStr = `${h}:${m}:${s} UTC`;
            
            document.getElementById('date-utc').innerText = dateStr;
            document.getElementById('clock').innerText = clockStr;

            if (!document.getElementById('qsoCall').value && !document.getElementById('qsoDate').value) {
                document.getElementById('qsoDate').value = dateStr;
                document.getElementById('qsoTime').value = h + ":" + m;
            }
        }
        setInterval(updateClock, 1000);

        function saveOperator() {
            operator = {
                call: document.getElementById('opCall').value.toUpperCase().trim(),
                name: document.getElementById('opName').value.trim(),
                email: document.getElementById('opEmail').value.trim()
            };
            localStorage.setItem('operator', JSON.stringify(operator));
        }

        function loadOperator() {
            document.getElementById('opCall').value = operator.call || '';
            document.getElementById('opName').value = operator.name || '';
            document.getElementById('opEmail').value = operator.email || '';
        }

        function checkQRZ(id) {
            const call = document.getElementById(id).value.toUpperCase().trim();
            if(call) window.open(`https://www.qrz.com/db/${call}`, '_blank');
        }

        function processQSO() {
            if (isEditing) {
                updateQSO();
            } else {
                addQSO();
            }
        }

        function addQSO() {
            const call = document.getElementById('qsoCall').value.toUpperCase().trim();
            if(!call) return;

            const rawDate = document.getElementById('qsoDate').value.replace(/-/g, '');
            const rawTime = document.getElementById('qsoTime').value.replace(/:/g, '');

            const newQso = {
                id: Date.now(),
                call: call,
                name: document.getElementById('qsoName').value.trim(),
                email: document.getElementById('qsoEmail').value.trim(),
                rst: document.getElementById('qsoRst').value.trim() || '59',
                date: rawDate,
                time: rawTime,
                band: document.getElementById('qsoBand').value,
                mode: document.getElementById('qsoMode').value,
                notes: document.getElementById('qsoNotes').value,
                qrz: document.getElementById('exportQRZ').checked ? 'Y' : 'N'
            };

            qsos.unshift(newQso);
            saveAndRender();
            clearForm();
        }

        function editQSO(id) {
            const q = qsos.find(item => item.id === id);
            if (!q) return;

            isEditing = true;
            document.getElementById('editId').value = q.id;
            document.getElementById('qsoCall').value = q.call;
            document.getElementById('qsoName').value = q.name;
            document.getElementById('qsoEmail').value = q.email;
            document.getElementById('qsoRst').value = q.rst;
            document.getElementById('qsoDate').value = `${q.date.slice(0,4)}-${q.date.slice(4,6)}-${q.date.slice(6,8)}`;
            document.getElementById('qsoTime').value = `${q.time.slice(0,2)}:${q.time.slice(2,4)}`;
            document.getElementById('qsoBand').value = q.band;
            document.getElementById('qsoMode').value = q.mode;
            document.getElementById('qsoNotes').value = q.notes;
            document.getElementById('exportQRZ').checked = q.qrz === 'Y';

            // EstÃ©tica de ediciÃ³n
            document.getElementById('formPanel').classList.add('editing-mode');
            document.getElementById('formTitle').innerText = "| EDITANDO CONTACTO";
            document.getElementById('formTitle').style.color = "var(--neon-yellow)";
            document.getElementById('btnSubmit').innerText = "Actualizar Contacto ðŸ’¾";
            document.getElementById('btnSubmit').className = "btn-action btn-csv";
            document.getElementById('btnCancelEdit').style.display = "block";
            
            document.getElementById('qsoCall').focus();
        }

        function updateQSO() {
            const id = parseInt(document.getElementById('editId').value);
            const index = qsos.findIndex(q => q.id === id);
            
            if (index !== -1) {
                const rawDate = document.getElementById('qsoDate').value.replace(/-/g, '');
                const rawTime = document.getElementById('qsoTime').value.replace(/:/g, '');

                qsos[index] = {
                    ...qsos[index],
                    call: document.getElementById('qsoCall').value.toUpperCase().trim(),
                    name: document.getElementById('qsoName').value.trim(),
                    email: document.getElementById('qsoEmail').value.trim(),
                    rst: document.getElementById('qsoRst').value.trim(),
                    date: rawDate,
                    time: rawTime,
                    band: document.getElementById('qsoBand').value,
                    mode: document.getElementById('qsoMode').value,
                    notes: document.getElementById('qsoNotes').value,
                    qrz: document.getElementById('exportQRZ').checked ? 'Y' : 'N'
                };

                saveAndRender();
                cancelEdit();
            }
        }

        function cancelEdit() {
            isEditing = false;
            document.getElementById('formPanel').classList.remove('editing-mode');
            document.getElementById('formTitle').innerText = "| REGISTRAR QSO";
            document.getElementById('formTitle').style.color = "var(--neon-pink)";
            document.getElementById('btnSubmit').innerText = "Grabar Contacto âš¡";
            document.getElementById('btnSubmit').className = "btn-action btn-adif";
            document.getElementById('btnCancelEdit').style.display = "none";
            clearForm();
        }

        function clearForm() {
            document.getElementById('editId').value = "";
            document.getElementById('qsoCall').value = "";
            document.getElementById('qsoName').value = "";
            document.getElementById('qsoEmail').value = "";
            document.getElementById('qsoNotes').value = "";
            document.getElementById('qsoDate').value = "";
            document.getElementById('qsoTime').value = "";
            updateClock();
        }

        function saveAndRender() {
            localStorage.setItem('qsos', JSON.stringify(qsos));
            const term = document.getElementById('searchLog').value.toUpperCase();
            const body = document.getElementById('logBody');
            const filtered = qsos.filter(q => q.call.includes(term) || q.name.toUpperCase().includes(term));

            body.innerHTML = filtered.map(q => `
                <tr>
                    <td><b style="color:var(--neon-yellow)">${q.call}</b><br><small>${q.name || ''}</small></td>
                    <td style="font-family: monospace;">${q.date.slice(0,4)}-${q.date.slice(4,6)}-${q.date.slice(6,8)}<br><span style="color:var(--neon-cyan)">${q.time}z</span></td>
                    <td>${q.band}<br><small>${q.mode}</small></td>
                    <td style="color:${q.qrz === 'Y' ? 'var(--neon-cyan)' : '#444'}">${q.qrz === 'Y' ? 'SI' : 'NO'}</td>
                    <td style="text-align: right; white-space: nowrap;">
                        <button onclick="editQSO(${q.id})" class="btn-action btn-edit" title="Editar">âœŽ</button>
                        <button onclick="deleteQSO(${q.id})" style="background:none; border:none; color:var(--neon-pink); cursor:pointer; font-size: 1.2rem;" title="Eliminar">Ã—</button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('totalCount').innerText = qsos.length;
        }

        function deleteQSO(id) {
            if(confirm("Â¿Eliminar registro?")) {
                if (isEditing && document.getElementById('editId').value == id) cancelEdit();
                qsos = qsos.filter(q => q.id !== id);
                saveAndRender();
            }
        }

        function clearAll() {
            if(confirm("Â¿Borrar todo el historial?")) {
                qsos = [];
                cancelEdit();
                saveAndRender();
            }
        }

        function downloadADIF() {
            let adif = "ADIF Export from NEON LOG STATION\n";
            adif += `<PROGRAMID:8>NEON_LOG\n<PROGRAMVERSION:5>4.3.5\n<EOH>\n`;
            
            qsos.forEach(q => {
                adif += `<CALL:${q.call.length}>${q.call}`;
                adif += `<QSO_DATE:8>${q.date}`;
                adif += `<TIME_ON:${q.time.length}>${q.time}`;
                adif += `<BAND:${q.band.length}>${q.band}`;
                adif += `<MODE:${q.mode.length}>${q.mode}`;
                adif += `<RST_SENT:${q.rst.length}>${q.rst}`;
                
                if(q.name) adif += `<NAME:${q.name.length}>${q.name}`;
                if(q.email) adif += `<EMAIL:${q.email.length}>${q.email}`;
                if(q.notes) adif += `<COMMENT:${q.notes.length}>${q.notes}`;
                
                if(operator.call) adif += `<STATION_CALLSIGN:${operator.call.length}>${operator.call}`;
                if(operator.call) adif += `<OPERATOR:${operator.call.length}>${operator.call}`;
                if(operator.name) adif += `<MY_NAME:${operator.name.length}>${operator.name}`;
                if(operator.email) adif += `<MY_EMAIL:${operator.email.length}>${operator.email}`;
                
                adif += `<EOR>\n`;
            });

            downloadFile(adif, 'Log_NeonStation_v4.3.5.adi');
        }

        function downloadCSV() {
            let csv = "Call,Date,Time,Band,Mode,RST,Name,Email,Notes\n";
            qsos.forEach(q => {
                csv += `${q.call},${q.date},${q.time},${q.band},${q.mode},${q.rst},"${q.name}","${q.email}","${q.notes}"\n`;
            });
            downloadFile(csv, 'Log_NeonStation_v4.3.5.csv');
        }

        function downloadFile(content, fileName) {
            const blob = new Blob([content], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = fileName;
            a.click();
        }

        loadOperator();
        updateClock();
        saveAndRender();
    </script>
</body>
</html>
