<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ADIF COMMANDER | CL7ADV</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent-blue: #008c9e;
            --neon-pink: #ff00ff;
            --neon-green: #2ecc71;
            --bg-light: #f5f5dc; 
            --text-dark: #2c3e50;
        }

        * { box-sizing: border-box; }
        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            font-family: 'Roboto Mono', monospace;
            margin: 0;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- CINEMÁTICA LÁSER --- */
        #intro-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #fff;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .laser-beam {
            position: absolute;
            height: 4px;
            background: var(--accent-blue);
            box-shadow: 0 0 15px var(--accent-blue);
            width: 0;
            left: -100%;
            animation: laserShoot 1.5s cubic-bezier(0.645, 0.045, 0.355, 1) forwards;
        }

        @keyframes laserShoot {
            0% { width: 0; left: 0; }
            50% { width: 100%; left: 0; }
            100% { width: 0; left: 100%; }
        }

        .intro-text {
            font-family: 'Orbitron', sans-serif;
            font-size: clamp(1rem, 4vw, 2rem);
            color: var(--text-dark);
            text-align: center;
            opacity: 0;
            animation: fadeInText 0.5s forwards 0.8s;
        }

        @keyframes fadeInText { to { opacity: 1; } }

        /* --- CABECERA Y RELOJ --- */
        .header-section { text-align: center; margin-bottom: 20px; position: relative; }
        
        .update-tag {
            display: inline-block;
            background: var(--accent-blue);
            color: white;
            font-family: 'Orbitron';
            font-size: 0.6rem;
            padding: 3px 10px;
            border-radius: 4px;
            box-shadow: inset 2px 2px 4px rgba(0,0,0,0.3), 2px 2px 5px rgba(0,0,0,0.2);
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        #utc-clock {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4rem;
            color: var(--accent-blue);
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        /* --- MODAL DE INFORMACIÓN --- */
        #info-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: white;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border: 3px solid var(--accent-blue);
            box-shadow: 0 0 30px rgba(0, 140, 158, 0.5);
        }

        .modal-header { font-family: 'Orbitron'; color: var(--accent-blue); margin-bottom: 15px; border-bottom: 2px solid var(--accent-blue); }

        #info-btn {
            position: fixed;
            bottom: 20px; right: 20px;
            width: 45px; height: 45px;
            background: #ffd700;
            color: #000;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 24px;
            cursor: pointer;
            z-index: 2000;
            border: 2px solid #b8860b;
        }

        /* --- CONTENEDOR PRINCIPAL --- */
        .terminal-container {
            width: 95%;
            max-width: 1100px;
            margin: 10px auto;
            border: 2px solid var(--accent-blue);
            background: white;
            padding: 20px;
            opacity: 0;
            animation: mainAppear 1s forwards 2s;
        }

        @keyframes mainAppear { to { opacity: 1; } }

        h1 { font-family: 'Orbitron'; text-align: center; color: var(--accent-blue); margin: 0; }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            background: #f9f9f9;
            padding: 20px;
            border: 1px solid #ddd;
            margin: 20px 0;
        }

        @media (min-width: 600px) { .input-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1000px) { .input-grid { grid-template-columns: repeat(4, 1fr); } }

        .label { color: var(--accent-blue); font-size: 0.7rem; margin-bottom: 5px; font-weight: bold; display: block; }
        
        input, select {
            width: 100%;
            background: white;
            border: 1px solid #ccc;
            padding: 10px;
            font-family: 'Roboto Mono';
            font-size: 16px;
        }

        .action-bar { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; }
        @media (min-width: 600px) { .action-bar { flex-direction: row; justify-content: center; } }

        button {
            padding: 12px 25px;
            font-family: 'Orbitron';
            background: var(--accent-blue);
            border: none;
            color: white;
            cursor: pointer;
        }

        .table-container { border: 1px solid #ddd; max-height: 350px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th { background: var(--accent-blue); color: white; padding: 12px; font-size: 0.7rem; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #eee; font-size: 0.8rem; }

        .footer-credits {
            text-align: center;
            font-size: 0.7rem;
            color: #777;
            margin-top: 30px;
            padding: 20px;
            line-height: 1.6;
        }
        
        .signature {
            font-family: 'Orbitron';
            color: var(--accent-blue);
            font-weight: bold;
            letter-spacing: 2px;
            margin-top: 10px;
        }

        .refresh-btn {
            background: #ddd;
            color: #333;
            padding: 2px 5px;
            font-size: 10px;
            margin-top: 5px;
            cursor: pointer;
            border: 1px solid #bbb;
            width: 100%;
        }
    </style>
</head>
<body>

    <div id="intro-screen">
        <div class="laser-beam"></div>
        <div class="intro-text">
            RADIOCLUB SANTA CRUZ DEL SUR<br>
            <span style="color: var(--accent-blue); font-weight: bold;">CL7ADV PROJECT</span>
        </div>
    </div>

    <div id="info-modal" onclick="closeInfo()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">LOGBOOK UPDATE: MANUAL UTC</div>
            <div style="font-size: 0.85rem; line-height: 1.5;">
                <strong>MEJORAS INCLUIDAS:</strong><br>
                • Hora fija en Estándar UTC Mundial.<br>
                • Entrada de Hora Manual (Texto).<br>
                • Sin selector de tiempo emergente.<br><br>
                <strong>HISTORIAL:</strong><br>
                Actualizado: 06 de Enero, 2026<br>
                Radio Club: Santa Cruz del Sur (Camagüey)<br><br>
                <div class="signature">JONATHAN & ALFRED</div>
                <br>
                <button onclick="closeInfo()" style="width:100%">CERRAR PANEL</button>
            </div>
        </div>
    </div>

    <div id="info-btn" onclick="toggleInfo()">?</div>

    <div class="terminal-container">
        <div class="header-section">
            <div class="update-tag">Relieve Update v2.7 - MANUAL UTC</div>
            <h1>ADIF COMMANDER</h1>
        </div>

        <div id="utc-clock">--:--:--</div>
        
        <div class="input-grid">
            <input type="hidden" id="edit-index" value="-1">
            <div class="input-box"><span class="label">Tu Indicativo</span><input type="text" id="my-call" placeholder="TU CALLSIGN"></div>
            <div class="input-box"><span class="label">Estación</span><input type="text" id="call" placeholder="CALLSIGN"></div>
            <div class="input-box"><span class="label">Nombre</span><input type="text" id="name" placeholder="OPERADOR"></div>
            <div class="input-box"><span class="label">Fecha</span><input type="date" id="date"></div>
            <div class="input-box">
                <span class="label">Hora QSO (UTC)</span>
                <input type="text" id="time" placeholder="HH:MM" maxlength="5" style="text-align: center; letter-spacing: 1px;">
                <button class="refresh-btn" onclick="forceUpdateTime()">CAPTURAR HORA UTC</button>
            </div>
            <div class="input-box"><span class="label">Banda</span><input type="text" id="band" placeholder="40M"></div>
            <div class="input-box">
                <span class="label">Modo</span>
                <select id="mode">
                    <option value="SSB">SSB</option>
                    <option value="USB">USB</option>
                    <option value="LSB">LSB</option>
                    <option value="CW">CW</option>
                    <option value="FT8">FT8</option>
                    <option value="FT4">FT4</option>
                    <option value="AM">AM</option>
                    <option value="FM">FM</option>
                    <option value="DMR">DMR</option>
                    <option value="VARAC">VARAC</option>
                    <option value="DV">DV</option>
                    <option value="RTTY">RTTY</option>
                    <option value="JS8">JS8</option>
                </select>
            </div>
            <div class="input-box"><span class="label">RST</span><input type="text" id="rst" placeholder="59"></div>
        </div>

        <div class="action-bar">
            <button onclick="handleEntry()" id="btn-main">AÑADIR QSO</button>
            <button style="background: var(--neon-pink);" onclick="exportADIF()">EXPORTAR ADIF</button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr><th>TU CALL</th><th>CALL</th><th>NOMBRE</th><th>FECHA</th><th>HORA</th><th>BANDA</th><th>MODO</th><th>RST</th><th>ACC</th></tr>
                </thead>
                <tbody id="log-body"></tbody>
            </table>
        </div>

        <div class="footer-credits">
            RADIO CLUB SANTA CRUZ DEL SUR, CUBA<br>
            <div class="signature">JONATHAN & ALFRED</div>
        </div>
    </div>

    <script>
        let qsoList = [];

        function updateClock() {
            const now = new Date();
            // Sistema forzado a UTC
            const h = now.getUTCHours();
            const m = String(now.getUTCMinutes()).padStart(2, '0');
            const s = String(now.getUTCSeconds()).padStart(2, '0');
            const year = now.getUTCFullYear();
            const month = String(now.getUTCMonth() + 1).padStart(2, '0');
            const day = String(now.getUTCDate()).padStart(2, '0');

            const displayH = String(h).padStart(2, '0');
            document.getElementById('utc-clock').innerText = `UTC: ${displayH}:${m}:${s}`;

            // Auto-relleno inicial solo si están vacíos
            if(!document.getElementById('date').value) {
                document.getElementById('date').value = `${year}-${month}-${day}`;
            }
            if(!document.getElementById('time').value) {
                document.getElementById('time').value = `${displayH}:${m}`;
            }
        }

        function forceUpdateTime() {
            const now = new Date();
            const h = String(now.getUTCHours()).padStart(2, '0');
            const m = String(now.getUTCMinutes()).padStart(2, '0');
            const year = now.getUTCFullYear();
            const month = String(now.getUTCMonth() + 1).padStart(2, '0');
            const day = String(now.getUTCDate()).padStart(2, '0');

            document.getElementById('date').value = `${year}-${month}-${day}`;
            // Se inserta como texto simple
            document.getElementById('time').value = `${h}:${m}`;
        }

        setInterval(updateClock, 1000);
        updateClock();

        function toggleInfo() { document.getElementById('info-modal').style.display = 'flex'; }
        function closeInfo() { document.getElementById('info-modal').style.display = 'none'; }

        setTimeout(() => {
            const intro = document.getElementById('intro-screen');
            intro.style.opacity = '0';
            setTimeout(() => intro.style.display = 'none', 800);
        }, 2200);

        function handleEntry() {
            const editIdx = document.getElementById('edit-index').value;
            const entry = {
                myCall: document.getElementById('my-call').value.toUpperCase(),
                call: document.getElementById('call').value.toUpperCase(),
                name: document.getElementById('name').value,
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                band: document.getElementById('band').value.toUpperCase(),
                mode: document.getElementById('mode').value,
                rst: document.getElementById('rst').value
            };

            if(!entry.call) return alert("Inserte el indicativo");

            if(editIdx === "-1") {
                qsoList.push(entry);
            } else {
                qsoList[editIdx] = entry;
                document.getElementById('edit-index').value = "-1";
                document.getElementById('btn-main').innerText = "AÑADIR QSO";
            }
            renderTable();
            clearInputs();
        }

        function renderTable() {
            const body = document.getElementById('log-body');
            body.innerHTML = "";
            qsoList.forEach((q, i) => {
                body.innerHTML += `<tr>
                    <td style="font-weight:bold; color:var(--accent-blue)">${q.myCall}</td>
                    <td style="font-weight:bold">${q.call}</td>
                    <td>${q.name}</td><td>${q.date}</td><td>${q.time}</td>
                    <td>${q.band}</td><td>${q.mode}</td><td>${q.rst}</td>
                    <td>
                        <button onclick="editRow(${i})" style="padding:2px 8px; background:var(--neon-green); font-size:10px">E</button>
                        <button onclick="deleteRow(${i})" style="padding:2px 8px; background:red; font-size:10px">X</button>
                    </td>
                </tr>`;
            });
        }

        function clearInputs() {
            ["call","name","band","rst"].forEach(id => document.getElementById(id).value = "");
            forceUpdateTime();
            document.getElementById('call').focus();
        }

        function deleteRow(i) { qsoList.splice(i, 1); renderTable(); }

        function editRow(i) {
            const q = qsoList[i];
            document.getElementById('my-call').value = q.myCall;
            document.getElementById('call').value = q.call;
            document.getElementById('name').value = q.name;
            document.getElementById('date').value = q.date;
            document.getElementById('time').value = q.time;
            document.getElementById('band').value = q.band;
            document.getElementById('mode').value = q.mode;
            document.getElementById('rst').value = q.rst;
            document.getElementById('edit-index').value = i;
            document.getElementById('btn-main').innerText = "GUARDAR";
            window.scrollTo(0,0);
        }

        function exportADIF() {
            if(qsoList.length === 0) return alert("No hay datos");
            let adif = `ADIF Export from CL7ADV\n<ADIF_VER:5>3.1.4\n<EOH>\n`;
            qsoList.forEach(q => {
                const cleanDate = q.date.replace(/-/g, "");
                // Limpieza extra por si el usuario escribe 14:30 o 1430
                const cleanTime = q.time.replace(/:/g, "").substring(0,4);
                adif += `<STATION_CALLSIGN:${q.myCall.length}>${q.myCall} ` +
                        `<CALL:${q.call.length}>${q.call} <NAME:${q.name.length}>${q.name} ` +
                        `<QSO_DATE:${cleanDate.length}>${cleanDate} <TIME_ON:${cleanTime.length}>${cleanTime} ` +
                        `<BAND:${q.band.length}>${q.band} <MODE:${q.mode.length}>${q.mode} ` +
                        `<RST_SENT:${q.rst.length}>${q.rst} <EOR>\n`;
            });

            const fileName = prompt("Nombre del Log:", "CL7ADV_LOG_UTC.adi");
            if(fileName) {
                const blob = new Blob([adif], {type: 'text/plain'});
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = fileName.endsWith('.adi') ? fileName : fileName + '.adi';
                a.click();
            }
        }
    </script>
</body>
</html>
